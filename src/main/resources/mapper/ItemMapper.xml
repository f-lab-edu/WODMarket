<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.flab.wodmarket.domain.item.ItemMapper">
    <resultMap id="Item" type="com.flab.wodmarket.domain.item.Item">
        <id property="itemNo" column="item_no"/>
        <result property="categoryNo" column="category_no"/>
        <result property="saleRate" column="sale_rate"/>
        <result property="saleStartDate" column="sale_start_date"/>
        <result property="saleEndDate" column="sale_end_date"/>
        <result property="regDate" column="reg_date"/>
        <result property="modDate" column="mod_date"/>
    </resultMap>


    <select id="findAll" parameterType="map" resultMap="Item">
        SELECT item.item_no         AS itemNo,
               item.name            AS name,
               item.price           AS price,
               item.sale            AS sale,
               item.stock           AS stock,
               item.sale_rate       AS saleRate,
               item.sale_start_date AS saleStartDate,
               item.sale_end_date   AS saleEndDate,
               item.status          AS status,
               cate.category_Name   AS categoryName,
               img.img_url          AS url,
               img.seq              AS imgSeq
        FROM item item
                 JOIN category cate on item.category_no = cate.category_no
                 INNER JOIN itemimg img ON item.item_no = img.item_no
        WHERE item.status = 'sale'
        ORDER BY item.item_no DESC
        LIMIT ${offset} , ${size}
    </select>

    <select id="countItem" resultType="int">
        SELECT COUNT(*) AS item_count
        FROM item
    </select>

    <select id="findById" resultMap="Item">
        SELECT DISTINCT item.item_no         AS itemNo,
                        item.name            AS name,
                        item.price           AS price,
                        item.sale            AS sale,
                        item.stock           AS stock,
                        item.sale_rate       AS saleRate,
                        item.sale_start_date AS saleStartDate,
                        item.sale_end_date   AS saleEndDate,
                        item.status          AS status,
                        cate.category_Name   AS categoryName
        FROM item item
                 JOIN category cate on item.category_no = cate.category_no
        WHERE item.item_no = #{itemNo}
          AND item.status = 'sale'
    </select>


    <insert id="save" parameterType="Item">
        INSERT INTO item
        (name,
         price,
         stock,
         sale_rate,
         sale_start_date,
         sale_end_date,
         status,
         detail,
         reg_date,
         mod_date)
        VALUES (#{name},
                #{price},
                #{stock},
                #{saleRate},
                #{saleStartDate},
                #{saleEndDate},
                #{status},
                #{detail},
                now(),
                now())
    </insert>

</mapper>